<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .datetime {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .nav {
            background: #f8f9fa;
            padding: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
        }

        .nav-btn:hover {
            background: #0056b3;
        }

        .nav-btn.active {
            background: #28a745;
        }

        .content {
            padding: 20px;
        }

        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .student-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .student-table th,
        .student-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .student-table th {
            background: #f8f9fa;
            font-weight: bold;
        }

        .status-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .status-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            min-width: 60px;
        }

        .status-present {
            background: #28a745;
            color: white;
        }

        .status-leave {
            background: #ffc107;
            color: black;
        }

        .status-notify {
            background: #17a2b8;
            color: white;
        }

        .status-unknown {
            background: #dc3545;
            color: white;
        }

        .status-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .status-box {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
        }

        .status-box h3 {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 5px;
            color: white;
            text-align: center;
        }

        .status-box.present h3 {
            background: #28a745;
        }

        .status-box.leave h3 {
            background: #ffc107;
            color: black;
        }

        .status-box.notify h3 {
            background: #17a2b8;
        }

        .status-box.unknown h3 {
            background: #dc3545;
        }

        .student-item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #ddd;
        }

        .hidden {
            display: none;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .student-table {
                font-size: 14px;
            }

            .student-table th:nth-child(2),
            .student-table td:nth-child(2) {
                max-width: 120px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .status-btn {
                padding: 4px 8px;
                font-size: 10px;
                min-width: 45px;
            }

            .status-sections {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
            }

            .btn {
                font-size: 14px;
                padding: 10px 16px;
            }
        }

        /* Dashboard Styles */
        .dashboard-item {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 5px solid #007bff;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            color: white;
        }

        .details-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .details-table th,
        .details-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .details-table th {
            background: #f8f9fa;
        }

        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .bar-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bar-name {
            min-width: 150px;
            font-size: 14px;
        }

        .bar-visual {
            flex: 1;
            background: #e9ecef;
            height: 25px;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(45deg, #dc3545, #c82333);
            border-radius: 12px;
            transition: width 0.3s ease;
        }

        .bar-count {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            font-weight: bold;
            color: white;
            z-index: 1;
        }

        /* Settings Styles */
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            background: #f8f9fa;
        }

        .student-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .student-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
        }

        .student-list-item:last-child {
            border-bottom: none;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
        }

        .btn-danger:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
            <div class="datetime" id="datetime"></div>
        </div>

        <div class="nav">
            <a href="#" class="nav-btn active" onclick="showPage('checkin')">‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠</a>
            <a href="#" class="nav-btn" onclick="showPage('dashboard')">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</a>
            <a href="#" class="nav-btn" onclick="showPage('settings')">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a>
            <a href="#" class="nav-btn" onclick="showPage('monthly')">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</a>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠ -->
        <div id="checkin-page" class="content">
            <div class="controls">
                <button class="btn btn-primary" onclick="submitData()">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button class="btn btn-secondary" onclick="resetData()">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</button>
            </div>

            <table class="student-table" id="student-table">
                <thead>
                    <tr>
                        <th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    </tr>
                </thead>
                <tbody id="student-tbody">
                </tbody>
            </table>

            <div class="status-sections">
                <div class="status-box present">
                    <h3>‡∏•‡∏á‡πÅ‡∏ñ‡∏ß</h3>
                    <div id="present-list"></div>
                </div>
                <div class="status-box leave">
                    <h3>‡∏•‡∏≤</h3>
                    <div id="leave-list"></div>
                </div>
                <div class="status-box notify">
                    <h3>‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏•‡∏á‡πÅ‡∏ñ‡∏ß</h3>
                    <div id="notify-list"></div>
                </div>
                <div class="status-box unknown">
                    <h3>‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                    <div id="unknown-list"></div>
                </div>
            </div>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î -->
        <div id="dashboard-page" class="content hidden">
            <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠</h2>
            <div id="dashboard-list"></div>
            
            <div class="chart-container">
                <h3>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∞‡∏™‡∏°‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
                <div class="bar-chart" id="unknown-chart"></div>
            </div>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ -->
        <div id="settings-page" class="content hidden">
            <h2>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h2>
            
            <h3>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
            <div class="upload-area">
                <p>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV (‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•)</p>
                <input type="file" id="csvFile" accept=".csv" onchange="uploadCSV(event)">
            </div>

            <h3>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
            <div class="student-list" id="student-list"></div>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô -->
        <div id="monthly-page" class="content hidden">
            <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
            <div id="monthly-summary"></div>
        </div>
    </div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        let students = [];
        let checkinData = [];
        let currentStudents = [];

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage
        function loadData() {
            const storedStudents = localStorage.getItem('students');
            const storedCheckinData = localStorage.getItem('checkinData');
            
            if (storedStudents) {
                students = JSON.parse(storedStudents);
            }
            
            if (storedCheckinData) {
                checkinData = JSON.parse(storedCheckinData);
            }
            
            resetCurrentStudents();
        }

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        function resetCurrentStudents() {
            currentStudents = students.map(student => ({
                ...student,
                status: null
            }));
            renderStudentTable();
            renderStatusBoxes();
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ö Real-time
        function updateDateTime() {
            const now = new Date();
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: 'Asia/Bangkok'
            };
            document.getElementById('datetime').textContent = now.toLocaleDateString('th-TH', options);
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        function renderStudentTable() {
            const tbody = document.getElementById('student-tbody');
            tbody.innerHTML = '';
            
            currentStudents
                .filter(student => !student.status)
                .forEach(student => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student.number}</td>
                        <td>${student.name}</td>
                        <td>
                            <div class="status-buttons">
                                <button class="status-btn status-present" onclick="setStatus(${student.number}, 'present')">
                                    <span class="desktop-text">‡∏•‡∏á‡πÅ‡∏ñ‡∏ß</span>
                                    <span class="mobile-text">‡∏•‡∏á</span>
                                </button>
                                <button class="status-btn status-leave" onclick="setStatus(${student.number}, 'leave')">
                                    <span class="desktop-text">‡∏•‡∏≤</span>
                                    <span class="mobile-text">‡∏•‡∏≤</span>
                                </button>
                                <button class="status-btn status-notify" onclick="setStatus(${student.number}, 'notify')">
                                    <span class="desktop-text">‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏•‡∏á‡πÅ‡∏ñ‡∏ß</span>
                                    <span class="mobile-text">‡πÅ‡∏à‡πâ‡∏á</span>
                                </button>
                                <button class="status-btn status-unknown" onclick="setStatus(${student.number}, 'unknown')">
                                    <span class="desktop-text">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                                    <span class="mobile-text">‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á</span>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
        }

        // ‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        function setStatus(studentNumber, status) {
            const student = currentStudents.find(s => s.number == studentNumber);
            if (student) {
                student.status = status;
                renderStudentTable();
                renderStatusBoxes();
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        function renderStatusBoxes() {
            const statuses = ['present', 'leave', 'notify', 'unknown'];
            const statusNames = {
                present: '‡∏•‡∏á‡πÅ‡∏ñ‡∏ß',
                leave: '‡∏•‡∏≤', 
                notify: '‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏•‡∏á‡πÅ‡∏ñ‡∏ß',
                unknown: '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
            };

            statuses.forEach(status => {
                const container = document.getElementById(`${status}-list`);
                const studentsWithStatus = currentStudents.filter(s => s.status === status);
                
                container.innerHTML = studentsWithStatus.map(student => 
                    `<div class="student-item">${student.number}. ${student.name}</div>`
                ).join('');
            });
        }

        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function submitData() {
            const now = new Date();
            const data = {
                timestamp: now.toISOString(),
                date: now.toLocaleDateString('th-TH'),
                time: now.toLocaleTimeString('th-TH'),
                students: currentStudents.filter(s => s.status).map(s => ({
                    number: s.number,
                    name: s.name,
                    status: s.status
                }))
            };

            checkinData.unshift(data); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
            localStorage.setItem('checkinData', JSON.stringify(checkinData));
            
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            resetCurrentStudents();
        }

        // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function resetData() {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                resetCurrentStudents();
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ
        function showPage(pageName) {
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            document.querySelectorAll('.content').forEach(page => {
                page.classList.add('hidden');
            });

            // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            document.getElementById(`${pageName}-page`).classList.remove('hidden');

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏∏‡πà‡∏° navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤
            if (pageName === 'dashboard') {
                renderDashboard();
            } else if (pageName === 'settings') {
                renderSettings();
            } else if (pageName === 'monthly') {
                renderMonthlySummary();
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
        function renderDashboard() {
            const container = document.getElementById('dashboard-list');
            container.innerHTML = '';

            checkinData.forEach((data, index) => {
                const stats = {
                    present: data.students.filter(s => s.status === 'present').length,
                    leave: data.students.filter(s => s.status === 'leave').length,
                    notify: data.students.filter(s => s.status === 'notify').length,
                    unknown: data.students.filter(s => s.status === 'unknown').length
                };

                const item = document.createElement('div');
                item.className = 'dashboard-item';
                item.innerHTML = `
                    <div class="dashboard-header">
                        <h3>${data.date} - ${data.time}</h3>
                        <button class="btn btn-danger" onclick="deleteCheckinData(${index})">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ</button>
                    </div>
                    <div class="dashboard-stats">
                        <div class="stat-item" style="background: #28a745;">
                            <div>‡∏•‡∏á‡πÅ‡∏ñ‡∏ß</div>
                            <div>${stats.present}</div>
                        </div>
                        <div class="stat-item" style="background: #ffc107; color: black;">
                            <div>‡∏•‡∏≤</div>
                            <div>${stats.leave}</div>
                        </div>
                        <div class="stat-item" style="background: #17a2b8;">
                            <div>‡πÅ‡∏à‡πâ‡∏á</div>
                            <div>${stats.notify}</div>
                        </div>
                        <div class="stat-item" style="background: #dc3545;">
                            <div>‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á</div>
                            <div>${stats.unknown}</div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="toggleDetails(${index})">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
                    <div id="details-${index}" class="hidden">
                        <table class="details-table">
                            <thead>
                                <tr>
                                    <th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.students.map(student => `
                                    <tr>
                                        <td>${student.number}</td>
                                        <td>${student.name}</td>
                                        <td>${getStatusText(student.status)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                container.appendChild(item);
            });

            renderUnknownChart();
        }

        // ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
        function toggleDetails(index) {
            const details = document.getElementById(`details-${index}`);
            details.classList.toggle('hidden');
        }

        // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡πá‡∏Å‡∏ä‡∏∑‡πà‡∏≠
        function deleteCheckinData(index) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                checkinData.splice(index, 1);
                localStorage.setItem('checkinData', JSON.stringify(checkinData));
                renderDashboard();
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function renderUnknownChart() {
            const unknownCounts = {};
            
            checkinData.forEach(data => {
                data.students
                    .filter(s => s.status === 'unknown')
                    .forEach(student => {
                        unknownCounts[student.name] = (unknownCounts[student.name] || 0) + 1;
                    });
            });

            const sortedData = Object.entries(unknownCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);

            const maxCount = Math.max(...sortedData.map(([,count]) => count), 1);
            const chartContainer = document.getElementById('unknown-chart');
            
            chartContainer.innerHTML = sortedData.map(([name, count]) => `
                <div class="bar-item">
                    <div class="bar-name">${name}</div>
                    <div class="bar-visual">
                        <div class="bar-fill" style="width: ${(count / maxCount) * 100}%"></div>
                        <div class="bar-count">${count}</div>
                    </div>
                </div>
            `).join('') || '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        function renderSettings() {
            const container = document.getElementById('student-list');
            container.innerHTML = '';
            
            students.forEach((student, index) => {
                const item = document.createElement('div');
                item.className = 'student-list-item';
                item.innerHTML = `
                    <span>${student.number}. ${student.name}</span>
                    <button class="btn btn-danger" onclick="deleteStudent(${index})">‡∏•‡∏ö</button>
                `;
                container.appendChild(item);
            });
        }

        // ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î CSV
        function uploadCSV(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                const lines = csv.split('\n');
                const newStudents = [];

                lines.forEach(line => {
                    const [number, name] = line.split(',').map(s => s.trim());
                    if (number && name) {
                        newStudents.push({ number: parseInt(number), name });
                    }
                });

                students = newStudents.sort((a, b) => a.number - b.number);
                localStorage.setItem('students', JSON.stringify(students));
                renderSettings();
                resetCurrentStudents();
                alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${students.length} ‡∏Ñ‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
            };
            reader.readAsText(file);
        }

        // ‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        function deleteStudent(index) {
            if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö ${students[index].name} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                students.splice(index, 1);
                localStorage.setItem('students', JSON.stringify(students));
                renderSettings();
                resetCurrentStudents();
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
        function renderMonthlySummary() {
            const container = document.getElementById('monthly-summary');
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            // ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
            const monthlyData = {};
            
            checkinData.forEach(data => {
                const date = new Date(data.timestamp);
                if (date.getMonth() === currentMonth && date.getFullYear() === currentYear) {
                    data.students.forEach(student => {
                        if (!monthlyData[student.name]) {
                            monthlyData[student.name] = {
                                leave: 0,
                                notify: 0,
                                unknown: 0
                            };
                        }
                        if (student.status === 'leave') monthlyData[student.name].leave++;
                        if (student.status === 'notify') monthlyData[student.name].notify++;
                        if (student.status === 'unknown') monthlyData[student.name].unknown++;
                    });
                }
            });

            // ‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (‡∏£‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß <= 4 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)
            const problemStudents = Object.entries(monthlyData)
                .filter(([name, data]) => (data.leave + data.notify + data.unknown) <= 4)
                .sort(([,a], [,b]) => (a.leave + a.notify + a.unknown) - (b.leave + b.notify + b.unknown));

            container.innerHTML = `
                <h3>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${new Date().toLocaleDateString('th-TH', { month: 'long', year: 'numeric' })}</h3>
                <div class="alert" style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h4>üö® ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠ (‡∏•‡∏≤ + ‡πÅ‡∏à‡πâ‡∏á + ‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö ‚â§ 4 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</h4>
                    ${problemStudents.length > 0 ? 
                        problemStudents.map(([name, data]) => `
                            <div style="padding: 10px; margin: 5px 0; background: white; border-radius: 5px;">
                                <strong>${name}</strong> - 
                                ‡∏•‡∏≤: ${data.leave} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á, ‡πÅ‡∏à‡πâ‡∏á: ${data.notify} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á, ‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö: ${data.unknown} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á 
                                (‡∏£‡∏ß‡∏°: ${data.leave + data.notify + data.unknown} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)
                            </div>
                        `).join('') : 
                        '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>'
                    }
                </div>
                
                <h4>‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                <table class="student-table">
                    <thead>
                        <tr>
                            <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                            <th>‡∏•‡∏≤</th>
                            <th>‡πÅ‡∏à‡πâ‡∏á</th>
                            <th>‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö</th>
                            <th>‡∏£‡∏ß‡∏°</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Object.entries(monthlyData).map(([name, data]) => `
                            <tr>
                                <td>${name}</td>
                                <td>${data.leave}</td>
                                <td>${data.notify}</td>
                                <td>${data.unknown}</td>
                                <td>${data.leave + data.notify + data.unknown}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢
        function getStatusText(status) {
            const statusMap = {
                present: '‡∏•‡∏á‡πÅ‡∏ñ‡∏ß',
                leave: '‡∏•‡∏≤',
                notify: '‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏•‡∏á‡πÅ‡∏ñ‡∏ß',
                unknown: '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
            };
            return statusMap[status] || status;
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
        function init() {
            loadData();
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö responsive text
            const style = document.createElement('style');
            style.textContent = `
                @media (min-width: 769px) {
                    .mobile-text { display: none; }
                }
                @media (max-width: 768px) {
                    .desktop-text { display: none; }
                }
            `;
            document.head.appendChild(style);
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>